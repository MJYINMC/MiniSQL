# 记录文件

## 普通的表格

### 属性信息

（大小为96+4+4+4+4+4) = 116

最多支持96位长度的属性名

| 属性名   | 属性类型                    | 属性长度 | 是否为主键  | 是否Unique | 索引的序号                              |
| -------- | --------------------------- | -------- | ----------- | ---------- | --------------------------------------- |
| Field    | Type                        | Length   | Primary_key | Unique     | Index_id = 0（代表没有在这个属性建索引) |
| char(96) | int (1: int 2:char 3:float) | int      | bool        | bool       | int                                     |

### Header

|          | 内容            | 类型      | 占位          | 说明                                |
| -------- | --------------- | --------- | ------------- | ----------------------------------- |
| 常规     | first_free_page | int       | 0-3           | 指向第一个可用的page                |
|          | capacity        | int       | 4-7           | 文件所能容纳page的最大数            |
|          | size            | int       | 8-11          | Page的数量                          |
| 数据部分 | table_name      | char(256) | 12-267        | 表的名字                            |
|          | record_length   | int       | 268-271       | 每一条记录所需的字节数              |
|          | record_capacity | int       | 272-275       | 每一页可以存下的记录数              |
|          | attribute_num   | int       | 276-279       | 表的属性数                          |
|          | attribute_size  | int       | 280-283       | 常数116，每一条属性记录所需的字节数 |
|          | attributes      | record[m] | 284-284+116*m | m为表的属性数，最大为32个属性       |



### Page

|          | 内容              | 类型     | 占位              | 说明                                                         |
| -------- | ----------------- | -------- | ----------------- | ------------------------------------------------------------ |
| 常规     | first_free_record | int      | 0-3               | 本页的第一个可用记录位置，若为-1代表本页已经被写满           |
| 数据部分 | record_array      | tuple[m] | record_length * m | 每一条record需要记录下所有属性和一个bool类型变量，指示该记录是否被删除了（读入时是否忽略） |

 

 



## 元数据表格（本质是特殊的记录文件）

### 表信息

(大小为256+4+4) = 264

最多支持256位长度的表名

| 表的序号 | 表的名字   | 表的属性数    |
| -------- | ---------- | ------------- |
| table_id | table_name | attribute_num |
| int      | char(256)  | int           |

### 属性信息

（大小为96+4+4+4+4+4) = 116

最多支持96位长度的属性名

| 属性名   | 属性类型                    | 属性长度 | 是否为主键  | 是否Unique | 索引的序号                              |
| -------- | --------------------------- | -------- | ----------- | ---------- | --------------------------------------- |
| Field    | Type                        | Length   | Primary_key | Unique     | Index_id = 0（代表没有在这个属性建索引) |
| char(96) | int (1: int 2:char 3:float) | int      | bool        | bool       | int                                     |

### Header

|          | 内容            | 类型 | 占位  | 说明                              |
| -------- | --------------- | ---- | ----- | --------------------------------- |
| 常规     | first_free_page | int  | 0-3   | 指向下一空白page, 0代表没有可用页 |
|          | capacity        | int  | 4-7   | 文件所能容纳page的最大数          |
|          | size            | int  | 8-11  | Page的数量                        |
| 数据部分 | table_num       | int  | 12-15 | 表的数量                          |
|          | index_num       | int  | 16-19 | 索引数量                          |
|          | record_length   | int  | 20-23 | 常量，3984                        |
|          | record_capacity | int  | 24-27 | 常量1，每一张Page存储一张表的信息 |

### Page

|          | 内容              | 类型      | 占位          | 说明                                               |
| -------- | ----------------- | --------- | ------------- | -------------------------------------------------- |
| 常规     | first_free_record | int       | 0-3           | 本页的第一个可用记录位置，若为-1代表本页已经被写满 |
| 数据部分 | valid             | bool      | 0-3           | 是否被删除的标记符号                               |
|          | table_id          | int       | 4-7           | 表的序号，实际上与page_id相同                      |
|          | table_name        | char(256) | 8-263         | 表的名字                                           |
|          | attribute_num     | int       | 264-267       | 表的属性数                                         |
|          | attribute_size    | int       | 268-271       | 常量116，每一个属性需要116个字节去存储             |
|          | attributes        | record[m] | 272-272+116*m | m为表的属性数，最大为32个属性                      |

​	